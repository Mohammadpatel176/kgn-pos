import re from"preact-render-to-string";import{StaticRouter as oe}from"react-router-dom/server.mjs";import{Link as z,Outlet as ae,Routes as le,Route as F}from"react-router-dom";import M,{useState as v,useRef as ce,useEffect as Y}from"preact/compat";import{FaCogs as ne,FaUserShield as de,FaShoppingCart as X,FaBox as q,FaFileInvoice as se,FaWarehouse as ie,FaBoxOpen as ue,FaFileExcel as pe,FaFilePdf as me,FaTrash as ge,FaPlus as he,FaSave as Ne,FaCalendarAlt as be,FaChevronLeft as xe,FaChevronRight as fe}from"react-icons/fa";import{jsxs as t,jsx as e,Fragment as ye}from"preact/jsx-runtime";import V from"jspdf";import B from"jspdf-autotable";import{toast as K,ToastContainer as ve}from"react-toastify";import T from"moment";import*as R from"xlsx";import{useState as E,useEffect as we}from"preact/hooks";import{MagnifyingGlassIcon as H,ArrowDownTrayIcon as Ie,PencilIcon as Q,PlusCircleIcon as Pe,TrashIcon as Se}from"@heroicons/react/24/outline";import{X as W,Minus as Ce,Plus as De,Save as J}from"lucide-react";import{Tooltip as _}from"react-tooltip";function Fe(){const[a,c]=v(!1);return t("aside",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),className:`bg-green-600 text-white h-full transition-all duration-300
        ${a?"w-64":"w-16"}`,children:[t("div",{className:"flex items-center gap-3 p-2 bg-green-700",children:[t(z,{to:"/",children:[" ",e("img",{src:"/KGNNewLOGO.png",alt:"Company Logo",className:"w-10 h-10 rounded-full object-contain"})]}),a&&e("span",{className:"font-semibold whitespace-nowrap",children:"KGN Auto Parts"})]}),t("nav",{className:"mt-4 space-y-2",children:[t(A,{open:a,icon:e(ne,{}),title:"Master",children:[e(D,{to:"/master/general",children:"General Master"}),e(D,{to:"/master/other",children:"Other Masters"}),e(D,{to:"/master/itemMaster",children:"Item Master List"})]}),e(ke,{open:a,icon:e(de,{}),title:"Administrator"}),t(A,{open:a,icon:e(X,{}),title:"Sales",children:[e(D,{to:"/sales/order",children:"Sales Order"}),e(D,{to:"/sales/invoice",children:"Sales Invoice"}),e(D,{to:"/sales/open-orders",children:"Open Order List"}),e(D,{to:"/sales/pos",children:"POS"})]}),e(A,{open:a,icon:e(q,{}),title:"Purchase",children:e(D,{to:"/purchase/order",children:"Purchase Order"})}),e(A,{open:a,icon:e(q,{}),title:"Inventory",children:e(D,{to:"/inventory/update",children:"Inventory Update"})})]})]})}function ke({icon:a,title:c,open:l}){return t("div",{className:"flex items-center gap-4 px-5 py-3 hover:bg-green-700 cursor-pointer",children:[a,l&&e("span",{children:c})]})}function A({icon:a,title:c,open:l,children:s}){return t("div",{children:[t("div",{className:"flex items-center gap-4 px-5 py-3 hover:bg-green-700 cursor-pointer",children:[a,l&&e("span",{children:c})]}),l&&e("div",{className:"ml-12 text-sm text-gray-200 space-y-1",children:s})]})}function D({to:a,children:c}){return e(z,{to:a,className:"block py-1 hover:text-black transition",children:c})}function Te(){const[a,c]=v(!1);return t("header",{className:"h-14 bg-green-700 border-b flex justify-between items-center px-6",children:[e("h1",{className:"text-lg font-semibold text-gray-800",children:"Dashboard"}),t("div",{className:"relative",children:[e("img",{src:"https://i.pravatar.cc/40",alt:"user",onClick:()=>c(!a),className:"w-9 h-9 rounded-full cursor-pointer border"}),a&&t("div",{className:"absolute right-0 mt-2 w-40 bg-white shadow-lg rounded-md z-200",children:[e("button",{className:"block w-full px-4 py-2 text-left hover:bg-gray-100",children:"My Profile"}),e("button",{className:"block w-full px-4 py-2 text-left text-red-600 hover:bg-gray-100",children:"Logout"})]})]})]})}function Oe(){return t("div",{className:"flex h-screen bg-gray-100",children:[e(Fe,{}),t("div",{className:"flex flex-col flex-1",children:[e(Te,{}),e("main",{className:"p-4 overflow-y-auto",children:e(ae,{})})]})]})}function Re(){return t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-semibold text-gray-800",children:"Dashboard"}),e("p",{className:"text-sm text-gray-500",children:"Overview of your business activities"})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:[e(L,{title:"Today's Sales",value:"â‚¹ 1,25,000",icon:e(X,{}),color:"bg-green-600"}),e(L,{title:"Invoices",value:"145",icon:e(se,{}),color:"bg-black"}),e(L,{title:"Inventory Stock",value:"8,540",icon:e(ie,{}),color:"bg-green-700"}),e(L,{title:"Pending Orders",value:"23",icon:e(ue,{}),color:"bg-black"})]}),t("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[t("div",{className:"xl:col-span-2 bg-white rounded-lg shadow p-5",children:[e("h2",{className:"font-semibold text-gray-700 mb-4",children:"Sales Summary"}),e("div",{className:"h-56 flex items-center justify-center text-gray-400",children:"ðŸ“Š Chart placeholder (connect Recharts / Chart.js)"})]}),t("div",{className:"bg-white rounded-lg shadow p-5 space-y-4",children:[e("h2",{className:"font-semibold text-gray-700",children:"Quick Stats"}),e(U,{label:"Today's Orders",value:"32"}),e(U,{label:"Purchase Orders",value:"18"}),e(U,{label:"Low Stock Items",value:"7",danger:!0}),e(U,{label:"Returns",value:"3"})]})]}),t("div",{className:"bg-white rounded-lg shadow p-5",children:[e("h2",{className:"font-semibold text-gray-700 mb-4",children:"Recent Transactions"}),e("div",{className:"overflow-x-auto",children:t("table",{className:"w-full text-sm",children:[e("thead",{className:"bg-gray-100 text-gray-600",children:t("tr",{children:[e("th",{className:"p-3 text-left",children:"Invoice No"}),e("th",{className:"p-3 text-left",children:"Customer"}),e("th",{className:"p-3 text-left",children:"Date"}),e("th",{className:"p-3 text-right",children:"Amount"}),e("th",{className:"p-3 text-center",children:"Status"})]})}),t("tbody",{children:[e(j,{invoice:"INV-1001",customer:"ABC Traders",date:"02 Jan 2026",amount:"â‚¹ 12,500",status:"Paid"}),e(j,{invoice:"INV-1002",customer:"XYZ Enterprises",date:"02 Jan 2026",amount:"â‚¹ 8,200",status:"Pending"}),e(j,{invoice:"INV-1003",customer:"Global Stores",date:"01 Jan 2026",amount:"â‚¹ 15,900",status:"Paid"})]})]})})]})]})}function L({title:a,value:c,icon:l,color:s}){return t("div",{className:"bg-white rounded-lg shadow p-5 flex justify-between items-center",children:[t("div",{children:[e("p",{className:"text-sm text-gray-500",children:a}),e("h3",{className:"text-xl font-bold text-gray-800",children:c})]}),e("div",{className:`w-12 h-12 rounded-full text-white flex items-center justify-center ${s}`,children:l})]})}function U({label:a,value:c,danger:l}){return t("div",{className:"flex justify-between text-sm",children:[e("span",{className:"text-gray-600",children:a}),e("span",{className:`font-semibold ${l?"text-red-600":"text-gray-800"}`,children:c})]})}function j({invoice:a,customer:c,date:l,amount:s,status:i}){const r=i==="Paid";return t("tr",{className:"border-b last:border-0",children:[e("td",{className:"p-3",children:a}),e("td",{className:"p-3",children:c}),e("td",{className:"p-3",children:l}),e("td",{className:"p-3 text-right",children:s}),e("td",{className:"p-3 text-center",children:e("span",{className:`px-3 py-1 rounded-full text-xs font-medium
            ${r?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:i})})]})}const G=JSON.parse('[{"productid":1,"productName":"Compact Frame","productPrice":1350,"productImageUrl":"/Images/Compect_Fram_Final.png","productDescription":"High-quality compact frame for auto rickshaws."},{"productid":2,"productName":"Back Door","productPrice":950,"productImageUrl":"/Images/Dore_Final.png","productDescription":"Durable metal back door for cargo space."},{"productid":3,"productName":"Compact Floor 18","productPrice":1200,"productImageUrl":"/Images/Flooring_14.png","productDescription":"18-gauge heavy-duty flooring sheet."},{"productid":4,"productName":"Compact Floor 14","productPrice":1350,"productImageUrl":"/Images/flooring_18.png","productDescription":"14-gauge premium flooring sheet."},{"productid":5,"productName":"Half Star","productPrice":100,"productImageUrl":"/Images/Samosa_final.png","productDescription":"Samosa style bracket support."},{"productid":6,"productName":"Alfa Floor","productPrice":1300,"productImageUrl":"/Images/side darvaja.png","productDescription":"Specialized flooring for Alfa models."},{"productid":1,"productName":"Y Support","productPrice":250,"productImageUrl":"/Images/test_new.png","productDescription":"Reinforced Y-shaped structural support."},{"productid":1,"productName":"Compact Frame","productPrice":1350,"productImageUrl":"/Images/Compect_Fram_Final.png","productDescription":"High-quality compact frame for auto rickshaws."},{"productid":2,"productName":"Back Door","productPrice":950,"productImageUrl":"/Images/Dore_Final.png","productDescription":"Durable metal back door for cargo space."},{"productid":3,"productName":"Compact Floor 18","productPrice":1200,"productImageUrl":"/Images/Flooring_14.png","productDescription":"18-gauge heavy-duty flooring sheet."},{"productid":4,"productName":"Compact Floor 14","productPrice":1350,"productImageUrl":"/Images/flooring_18.png","productDescription":"14-gauge premium flooring sheet."},{"productid":5,"productName":"Half Star","productPrice":100,"productImageUrl":"/Images/Samosa_final.png","productDescription":"Samosa style bracket support."},{"productid":6,"productName":"Alfa Floor","productPrice":1300,"productImageUrl":"/Images/side_darvaja.png","productDescription":"Specialized flooring for Alfa models."},{"productid":7,"productName":"Y Support","productPrice":250,"productImageUrl":"/Images/test_new.png","productDescription":"Reinforced Y-shaped structural support."},{"productid":8,"productName":"GLASS FRAME PASSENGER","productPrice":0,"productImageUrl":"/Images/GlassFrame_Pecenger.png","productDescription":"Glass frame for passenger auto rickshaw."},{"productid":9,"productName":"GLASS FRAME LOADING","productPrice":0,"productImageUrl":"/Images/Glass_frame_loading.png","productDescription":"Glass frame for loading auto rickshaw."},{"productid":10,"productName":"FRONT FLOORING","productPrice":0,"productImageUrl":"/Images/FrontFlooring.png","productDescription":"Front flooring sheet."},{"productid":11,"productName":"FRONT DERA","productPrice":0,"productImageUrl":"/Images/FrontDera.png","productDescription":"Front dera body component."},{"productid":12,"productName":"BODY PASSENGER OLD","productPrice":0,"productImageUrl":"/Images/BodyPacengerOld.png","productDescription":"Old model passenger body."},{"productid":13,"productName":"DELUX PASSENGER BODY","productPrice":0,"productImageUrl":"/Images/DeluxPacengerBody.png","productDescription":"Deluxe passenger body."},{"productid":14,"productName":"COMPLETE TROLLEY O/M","productPrice":0,"productImageUrl":"/Images/CompleteTrolyOM.png","productDescription":"Complete trolley old model."},{"productid":15,"productName":"X.L.D TROLLEY GREEN","productPrice":0,"productImageUrl":"/Images/XLDTrollyGreen.png","productDescription":"XLD trolley painted green."},{"productid":16,"productName":"X.L.D TROLLEY YELLOW","productPrice":0,"productImageUrl":"/Images/XLDTrollyYellow.png","productDescription":"XLD trolley painted yellow."},{"productid":17,"productName":"X.L.D TROLLEY RED","productPrice":0,"productImageUrl":"/Images/XLDTrollyRed.png","productDescription":"XLD trolley painted red."},{"productid":18,"productName":"TROLLEY X.L.D N/M","productPrice":0,"productImageUrl":"/Images/XLDTrollyXM.png","productDescription":"XLD trolley new model."},{"productid":19,"productName":"CITY GLASS FRAME","productPrice":0,"productImageUrl":"/Images/ApeCityGlassFrame.png","productDescription":"City model glass frame."},{"productid":20,"productName":"TROLLEY FLOORING WITH CHANNEL","productPrice":0,"productImageUrl":"/Images/TrollyFlooringWithChenal.png","productDescription":"Trolley flooring with support channel."},{"productid":21,"productName":"TROLLEY FLOORING","productPrice":0,"productImageUrl":"/Images/TrollyFlooring.png","productDescription":"Standard trolley flooring."},{"productid":22,"productName":"LD TROLLEY FLOORING","productPrice":0,"productImageUrl":"/Images/LDTrollyFlooring.png","productDescription":"Loading trolley flooring."},{"productid":23,"productName":"PASSENGER CENTER FLOORING","productPrice":0,"productImageUrl":"/Images/PessCenterFlooring.png","productDescription":"Passenger center flooring."},{"productid":24,"productName":"ENGINE BONNET","productPrice":0,"productImageUrl":"/Images/EngenBonnat.png","productDescription":"Engine bonnet cover."},{"productid":25,"productName":"REAR TAILGATE PASSENGER","productPrice":0,"productImageUrl":"/Images/RtelgetPec.png","productDescription":"Passenger rear tailgate."},{"productid":26,"productName":"DRIVER PARTITION (TAKA)","productPrice":0,"productImageUrl":"/Images/DrivPartation.png","productDescription":"Driver partition panel."},{"productid":27,"productName":"FRONT FALKA LOADING","productPrice":0,"productImageUrl":"/Images/FrntFalkaLod.png","productDescription":"Front falka for loading body."},{"productid":28,"productName":"SIDE FALKA LOADING","productPrice":0,"productImageUrl":"/Images/SideFalkaLod.png","productDescription":"Side falka for loading body."},{"productid":29,"productName":"SIDE PANEL PASSENGER","productPrice":0,"productImageUrl":"/Images/SidePanelPecg.png","productDescription":"Passenger side panel."},{"productid":30,"productName":"TOP","productPrice":0,"productImageUrl":"/Images/Top.png","productDescription":"Vehicle top body part."},{"productid":31,"productName":"DIESEL TANK PATARA","productPrice":0,"productImageUrl":"/Images/DesialTankPatra.png","productDescription":"Diesel tank protection patara."},{"productid":32,"productName":"FRONT CONA BIG PASSENGER","productPrice":0,"productImageUrl":"/Images/FrontConeBigPecg.png","productDescription":"Front big cona passenger."},{"productid":33,"productName":"REAR CONA SMALL PASSENGER","productPrice":0,"productImageUrl":"/Images/RearConeSmallPecg.png","productDescription":"Rear small cona passenger."},{"productid":34,"productName":"FOOT REST","productPrice":0,"productImageUrl":"/Images/FootRest.png","productDescription":"Foot rest support."},{"productid":35,"productName":"TEKA","productPrice":0,"productImageUrl":"/Images/Teka.png","productDescription":"Structural teka support."},{"productid":36,"productName":"COMPLETE DOOR","productPrice":0,"productImageUrl":"/Images/CompectDore.png","productDescription":"Complete side door."},{"productid":37,"productName":"FRONT MUDGUARD","productPrice":0,"productImageUrl":"/Images/FrontMudgart.png","productDescription":"Front mudguard."},{"productid":38,"productName":"FRONT FLOORING CORNER SAMOSA","productPrice":0,"productImageUrl":"/Images/FrontFloringRearCorner.png","productDescription":"Front flooring corner samosa."},{"productid":39,"productName":"FRONT FLOORING REAR CONA","productPrice":0,"productImageUrl":"/Images/FrontFloringRearCorner.png","productDescription":"Front flooring rear cona."},{"productid":40,"productName":"TEKA PILLAR","productPrice":0,"productImageUrl":"/Images/TekaPiller.png","productDescription":"Teka pillar support."},{"productid":41,"productName":"DERA SUPPORT","productPrice":0,"productImageUrl":"/Images/DearSupport.png","productDescription":"Dera body support."},{"productid":42,"productName":"MIRROR CLAMP","productPrice":0,"productImageUrl":"/Images/MirrorClamp.png","productDescription":"Mirror clamp holder."},{"productid":43,"productName":"SIDE MUDGUARD","productPrice":0,"productImageUrl":"/Images/SideMudgard.png","productDescription":"Side mudguard."},{"productid":44,"productName":"HOOD PIPE","productPrice":0,"productImageUrl":"/Images/HoodPipe.png","productDescription":"Hood pipe support."},{"productid":45,"productName":"REAR GUARD","productPrice":0,"productImageUrl":"/Images/RearGuard.png","productDescription":"Rear safety guard."}]');function Ae({name:a,price:c,image:l,onAdd:s}){return t("div",{className:"group bg-white w-full rounded-xl p-4 shadow-sm hover:shadow-md border border-gray-200 transition-all",children:[e("div",{className:"h-32 w-full overflow-hidden rounded-lg bg-gray-50",children:e("img",{src:l,alt:a,className:"w-full h-full object-contain group-hover:scale-110 transition-transform"})}),e("h3",{className:"mt-3 font-semibold text-sm h-10 overflow-hidden",children:a}),t("p",{className:"text-lg font-bold text-gray-900",children:["â‚¹",c]}),e("button",{onClick:s,className:"w-full mt-3 bg-green-600 text-white py-2 rounded-lg text-sm font-bold hover:bg-black transition-colors",children:"+ Add to Bill"})]})}const Le=({isOpen:a,onClose:c,formData:l,setFormData:s,onConfirm:i})=>{if(!a)return null;const r=m=>{const{name:y,value:d,type:N,checked:g}=m.target;s(h=>({...h,[y]:N==="checkbox"?g:d}))};return e("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4",children:t("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[t("div",{className:"p-6 border-b flex justify-between items-center bg-green-700 text-white sticky top-0 z-10",children:[t("div",{children:[e("h2",{className:"text-xl font-bold uppercase tracking-wide",children:"Customer Billing Details"}),e("p",{className:"text-xs text-green-100",children:"KGN Motors Official POS"})]}),e("button",{onClick:c,className:"text-3xl hover:text-gray-200",children:"Ã—"})]}),t("form",{className:"p-6 space-y-6",onSubmit:i,children:[t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Customer / Party Name *"}),e("input",{name:"customerName",type:"text",required:!0,value:l.customerName,onChange:r,className:"w-full border-2 border-gray-200 p-2 rounded-lg focus:border-green-600 outline-none",placeholder:"Full Name"})]}),t("div",{children:[e("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Phone Number *"}),e("input",{name:"customerPhone",type:"tel",required:!0,value:l.customerPhone,onChange:r,className:"w-full border-2 border-gray-200 p-2 rounded-lg focus:border-green-600 outline-none",placeholder:"Contact No."})]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Supplier Name"}),e("input",{name:"supplierName",type:"text",value:l.supplierName,onChange:r,className:"w-full border border-gray-200 p-2 rounded-lg",placeholder:"Optional"})]}),t("div",{children:[e("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"GST Number"}),e("input",{name:"gstNumber",type:"text",value:l.gstNumber,onChange:r,className:"w-full border border-gray-200 p-2 rounded-lg",placeholder:"22AAAAA0000A1Z5"})]})]}),t("div",{className:"flex items-center gap-3 bg-gray-50 p-4 rounded-xl border-2 border-dashed border-gray-200",children:[e("input",{name:"isVehicle",type:"checkbox",id:"vehicle",checked:l.isVehicle,onChange:r,className:"w-6 h-6 accent-green-700 cursor-pointer"}),e("label",{htmlFor:"vehicle",className:"font-bold text-gray-700 cursor-pointer",children:"Include Vehicle & Driver Details?"})]}),l.isVehicle&&t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-green-50 rounded-xl border border-green-200 transition-all",children:[t("div",{children:[e("label",{className:"block text-xs font-bold text-green-800 mb-1",children:"Driver Name *"}),e("input",{name:"driverName",type:"text",required:l.isVehicle,value:l.driverName,onChange:r,className:"w-full border border-green-300 p-2 rounded-lg bg-white"})]}),t("div",{children:[e("label",{className:"block text-xs font-bold text-green-800 mb-1",children:"Vehicle No. *"}),e("input",{name:"vehicleNumber",type:"text",required:l.isVehicle,value:l.vehicleNumber,onChange:r,className:"w-full border border-green-300 p-2 rounded-lg bg-white",placeholder:"GJ-XX-0000"})]}),t("div",{children:[e("label",{className:"block text-xs font-bold text-green-800 mb-1",children:"Driver Phone *"}),e("input",{name:"driverPhone",type:"tel",required:l.isVehicle,value:l.driverPhone,onChange:r,className:"w-full border border-green-300 p-2 rounded-lg bg-white"})]})]}),t("div",{children:[e("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Additional Business Details"}),e("textarea",{name:"businessDetails",value:l.businessDetails,onChange:r,className:"w-full border border-gray-200 p-2 rounded-lg",rows:"2",placeholder:"Address or special notes..."})]}),t("div",{className:"flex gap-4 pt-4 sticky bottom-0 bg-white",children:[e("button",{type:"button",onClick:c,className:"flex-1 px-6 py-3 rounded-xl font-bold border-2 border-gray-200 hover:bg-gray-50 transition-all",children:"Cancel"}),e("button",{type:"submit",className:"flex-1 bg-green-700 text-white px-6 py-3 rounded-xl font-bold hover:bg-black transition-all shadow-lg",children:"Confirm & Generate Bill"})]})]})]})})},Ue=a=>new Promise((c,l)=>{const s=new Image;s.src=a,s.onload=()=>c(s),s.onerror=i=>l(i)}),Ee=async(a,c,l,s,i)=>{const r=new V("p","mm","a4"),m=(s/2).toFixed(2),y="/KGNNewLOGO.png";try{const d=await Ue(y);r.saveGraphicsState(),r.setGState(new r.GState({opacity:.05})),r.addImage(d,"PNG",55,100,100,100),r.restoreGraphicsState(),r.addImage(d,"PNG",14,10,22,22),r.setTextColor(0,100,0),r.setFontSize(22),r.setFont("helvetica","bold"),r.text("KGN MOTORS",40,18),r.setFontSize(8),r.setFont("helvetica","normal"),r.setTextColor(60),r.text("Shop No. 12, Auto Plaza, Near Railway Crossing,",40,23),r.text("Sarkhej Road, Juhapura, Ahmedabad - 380055",40,27),r.text("GSTIN: 24ABCCE1234F1Z5 | State: Gujarat (24)",40,31),r.text("Email: kgnmotors.abd@gmail.com | Mob: +91 99721 XXXXX",40,35),r.setTextColor(0),r.setFontSize(14),r.text("TAX INVOICE",150,18),r.setFontSize(9);const N=`KGN/25-26/${Math.floor(1e3+Math.random()*9e3)}`;r.text(`Invoice No: ${N}`,150,24),r.text(`Date: ${new Date().toLocaleDateString("en-IN")}`,150,29),r.setDrawColor(0,100,0),r.setLineWidth(.5),r.line(14,38,196,38),r.setFont("helvetica","bold"),r.text("BILL TO:",14,46),r.setFont("helvetica","normal"),r.text(`${a.customerName.toUpperCase()}`,14,51),r.text(`Phone: +91 ${a.customerPhone}`,14,56),a.isVehicle&&(r.setFont("helvetica","bold"),r.text("VEHICLE:",120,46),r.setFont("helvetica","normal"),r.text(`No: ${a.vehicleNumber.toUpperCase()}`,120,51),r.text(`Driver: ${a.driverName}`,120,56)),B(r,{startY:65,head:[["SR.","ITEM DESCRIPTION","QTY","RATE","CGST(9%)","SGST(9%)","AMOUNT"]],body:c.map((n,o)=>{const p=n.productPrice*n.quantity,b=(p*.09).toFixed(2);return[o+1,n.productName.toUpperCase(),n.quantity,n.productPrice.toFixed(2),b,b,(p+parseFloat(b)*2).toFixed(2)]}),theme:"grid",styles:{fontSize:8,cellPadding:3,textColor:[0,0,0]},headStyles:{fillColor:[0,100,0],halign:"center"},columnStyles:{0:{halign:"center",cellWidth:10},1:{cellWidth:55},2:{halign:"center"},3:{halign:"right"},4:{halign:"right"},5:{halign:"right"},6:{halign:"right",fontStyle:"bold"}}});let g=r.lastAutoTable.finalY+10;const h=140,f=196;r.setFontSize(10),r.text("Taxable Value:",h,g),r.text(`${l.toFixed(2)}`,f,g,{align:"right"}),r.text("Total CGST:",h,g+5),r.text(`${m}`,f,g+5,{align:"right"}),r.text("Total SGST:",h,g+10),r.text(`${m}`,f,g+10,{align:"right"}),r.setLineDash([1,1],0),r.line(h,g+13,196,g+13),r.setFont(void 0,"bold"),r.setFontSize(12),r.text("GRAND TOTAL:",h,g+20),r.text(`Rs. ${i.toFixed(2)}`,f,g+20,{align:"right"});const x=270;r.setFontSize(9),r.text("For, KGN MOTORS",150,x-15),r.setLineDash([1,1],0),r.rect(148,x-13,45,15),r.text("Authorised Signatory",153,x+6),window.open(r.output("bloburl"),"_blank"),r.save(`KGN_INV_${Date.now()}.pdf`)}catch(d){console.error("PDF Generation failed",d)}},Z={position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0},O=a=>{K.success(a,Z)},ee=a=>{K.info(a,Z)};function Ge(){const[a]=v(G),[c,l]=v([]),[s,i]=v(!1),[r,m]=v(""),[y,d]=v("amount"),[N,g]=v(0),[h,f]=v({customerName:"",customerPhone:"",isVehicle:!1,driverName:"",vehicleNumber:"",driverPhone:""}),x=a.filter(u=>u.productName.toLowerCase().includes(r.toLowerCase())),n=u=>{l(I=>I.find(S=>S.productid===u.productid)?I.map(S=>S.productid===u.productid?{...S,quantity:S.quantity+1}:S):[...I,{...u,quantity:1}]),O(`${u.productName} added to cart!`)},o=(u,I)=>{l($=>$.map(S=>S.productid===u&&S.quantity+I>0?{...S,quantity:S.quantity+I}:S)),O(`${product.productName} quantity updated!`)},p=u=>{l(c.filter(I=>I.productid!==u)),ee("Item removed from cart!")},b=c.reduce((u,I)=>u+I.productPrice*I.quantity,0),P=y==="percent"?b*N/100:N,C=Math.max(b-P,0),w=C*.18,k=C+w,te=async u=>{u.preventDefault(),await Ee(h,c,b,P,w),l([]),g(0),i(!1),O("Invoice generated successfully!")};return t("div",{className:"flex w-full h-full bg-gray-100 overflow-hidden",children:[t("div",{className:"flex-1 p-6 overflow-y-auto",children:[e("h1",{className:"text-3xl font-black text-green-700 mb-2",children:"KGN MOTORS"}),e("input",{className:"w-full mb-4 px-4 py-2 border rounded-lg",placeholder:"Search auto parts...",value:r,onChange:u=>m(u.target.value)}),e("div",{className:"grid grid-cols-2 md:grid-cols-4 xl:grid-cols-5 gap-4",children:x.map(u=>e(Ae,{name:u.productName,price:u.productPrice,image:u.productImageUrl,onAdd:()=>n(u)},u.productid))})]}),t("div",{className:"w-[380px] bg-white shadow-xl flex flex-col",children:[t("div",{className:"bg-green-700 text-white p-4 font-bold",children:["CART (",c.reduce((u,I)=>u+I.quantity,0),")"]}),e("div",{className:"flex-1 p-4 space-y-3 overflow-y-auto bg-gray-50",children:c.map(u=>t("div",{className:"bg-white p-3 rounded border",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"font-bold text-xs",children:u.productName}),e("button",{onClick:()=>p(u.productid),className:"text-red-500",children:"âœ•"})]}),t("div",{className:"flex justify-between mt-2 items-center",children:[t("div",{className:"flex gap-3",children:[e("button",{onClick:()=>o(u.productid,-1),children:"-"}),e("span",{children:u.quantity}),e("button",{onClick:()=>o(u.productid,1),children:"+"})]}),t("span",{className:"font-bold",children:["â‚¹",u.productPrice*u.quantity]})]})]},u.productid))}),t("div",{className:"p-4 border-t space-y-2",children:[t("div",{className:"flex justify-between",children:[e("span",{children:"Subtotal"}),t("span",{children:["â‚¹",b.toFixed(2)]})]}),t("div",{className:"flex gap-2",children:[t("select",{className:"border px-2",value:y,onChange:u=>d(u.target.value),children:[e("option",{value:"amount",children:"â‚¹"}),e("option",{value:"percent",children:"%"})]}),e("input",{type:"number",className:"border flex-1 px-2",placeholder:"Discount",value:N,onChange:u=>g(+u.target.value)})]}),t("div",{className:"flex justify-between text-red-600 font-bold",children:[e("span",{children:"Discount"}),t("span",{children:["-â‚¹",P.toFixed(2)]})]}),t("div",{className:"flex justify-between",children:[e("span",{children:"GST (18%)"}),t("span",{children:["â‚¹",w.toFixed(2)]})]}),t("div",{className:"flex justify-between text-xl font-black",children:[e("span",{children:"TOTAL"}),t("span",{className:"text-green-700",children:["â‚¹",k.toFixed(2)]})]}),e("button",{onClick:()=>i(!0),disabled:!c.length,className:"w-full mt-4 bg-green-700 text-white py-3 rounded-lg font-bold",children:"PRINT INVOICE"})]})]}),e(Le,{isOpen:s,onClose:()=>i(!1),formData:h,setFormData:f,onConfirm:te})]})}function Me({selectedDate:a,onDateChange:c}){const[l,s]=v(!1),[i,r]=v(T()),[m,y]=v([]),d=ce(null);return Y(()=>{const N=T(i).startOf("month").startOf("week"),g=T(i).endOf("month").endOf("week"),h=N.clone().subtract(1,"day"),f=[];for(;h.isBefore(g,"day");)f.push(Array(7).fill(0).map(()=>h.add(1,"day").clone()));y(f)},[i]),t("div",{className:"relative w-full",ref:d,children:[e("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-1",children:"Delivery Date"}),t("div",{onClick:()=>s(!l),className:"flex items-center justify-between w-full border border-gray-300 rounded-lg p-3 bg-white cursor-pointer hover:border-green-500 transition-all focus-within:ring-2 focus-within:ring-green-200",children:[e("span",{className:"text-gray-800",children:T(a).format("DD MMM, YYYY")}),e(be,{className:"text-green-600"})]}),l&&t("div",{className:"absolute z-[100] mt-2 left-0 w-72 bg-white shadow-2xl rounded-xl border border-gray-100 p-4 animate-in fade-in zoom-in duration-200",children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("button",{onClick:()=>r(i.clone().subtract(1,"month")),className:"p-1 hover:bg-green-50 rounded text-green-700",children:e(xe,{})}),e("h3",{className:"font-bold text-gray-800 text-sm",children:i.format("MMMM YYYY")}),e("button",{onClick:()=>r(i.clone().add(1,"month")),className:"p-1 hover:bg-green-50 rounded text-green-700",children:e(fe,{})})]}),e("div",{className:"grid grid-cols-7 mb-2 text-center text-[10px] font-bold text-gray-400 uppercase",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(N=>e("div",{children:N},N))}),e("div",{className:"space-y-1",children:m.map((N,g)=>e("div",{className:"grid grid-cols-7",children:N.map((h,f)=>{const x=h.format("YYYY-MM-DD")===a,n=h.isSame(i,"month");return e("button",{onClick:()=>{c(h.format("YYYY-MM-DD")),s(!1)},className:`h-8 w-8 mx-auto flex items-center justify-center rounded-lg text-xs transition-all
                        ${n?"text-gray-700 hover:bg-green-100":"text-gray-200"}
                        ${x?"bg-green-600 text-white shadow-md scale-110":""}
                      `,children:h.date()},f)})},g))})]})]})}function je(){const[a,c]=v({name:"",date:T().format("YYYY-MM-DD"),poNumber:`PO-${Math.floor(1e3+Math.random()*9e3)}`}),[l,s]=v([{id:1,name:"",qty:1,price:0,total:0}]),[i,r]=v({rowId:null,results:[]}),m=l.reduce((o,p)=>o+p.qty*p.price,0),y=m*.18,d=m+y,N=()=>{s([...l,{id:Date.now(),name:"",qty:1,price:0,total:0}]),O("New item added to the order!")},g=o=>{l.length>1&&s(l.filter(p=>p.id!==o)),ee("Item removed from the order!")},h=(o,p,b)=>{const P=l.map(C=>{if(C.id===o){const w={...C,[p]:b};return w.total=w.qty*w.price,w}return C});if(s(P),p==="name")if(b.length>1){const C=G.filter(w=>w.productName.toLowerCase().includes(b.toLowerCase()));r({rowId:o,results:C})}else r({rowId:null,results:[]})},f=(o,p)=>{s(l.map(b=>b.id===o?{...b,name:p.productName,price:p.productPrice,total:b.qty*p.productPrice}:b)),r({rowId:null,results:[]})},x=()=>{const o=[["KGN AUTO PARTS - PURCHASE ORDER"],[`PO Number: ${a.poNumber}`],[`Vendor: ${a.name||"N/A"}`],[`Date: ${a.date}`],[""],["Product Description","Quantity","Unit Price (INR)","Total (INR)"]],p=l.map(k=>[k.name,k.qty,k.price,k.total]),b=[["","","Subtotal",m],["","","GST (18%)",y],["","","Grand Total",d]],P=[...o,...p,[""],...b],C=R.utils.aoa_to_sheet(P),w=R.utils.book_new();R.utils.book_append_sheet(w,C,"Purchase Order"),R.writeFile(w,`${a.poNumber}.xlsx`)},n=()=>{const o=new V,p=[22,163,74];o.setFillColor(...p),o.rect(0,0,210,25,"F"),o.setTextColor(255,255,255),o.setFontSize(14),o.text("KGN AUTO PARTS",14,12),o.setFontSize(8),o.text("Purchase Order Document",14,18),o.setFontSize(12),o.text("PURCHASE ORDER",150,15),o.setTextColor(40,40,40),o.setFontSize(9),o.setFont(void 0,"bold"),o.text("BILL TO:",14,35),o.setFont(void 0,"normal"),o.text("KGN Auto Parts, Ahmedabad, GJ",14,40),o.setFont(void 0,"bold"),o.text("ORDER DETAILS:",130,35),o.setFont(void 0,"normal"),o.text(`Vendor: ${a.name||"N/A"}`,130,40),o.text(`PO Number: ${a.poNumber}`,130,45),o.text(`Date: ${a.date}`,130,50),B(o,{startY:55,head:[["Description","Qty","Price","Total"]],body:l.map(P=>[P.name,P.qty,P.price.toFixed(2),P.total.toFixed(2)]),theme:"grid",styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:p,textColor:[255,255,255],halign:"center"},columnStyles:{1:{halign:"center"},2:{halign:"right"},3:{halign:"right"}}});const b=o.lastAutoTable.finalY+10;o.setFontSize(9),o.text("Subtotal:",140,b),o.text(`Rs. ${m.toFixed(2)}`,185,b,{align:"right"}),o.text("GST (18%):",140,b+5),o.text(`Rs. ${y.toFixed(2)}`,185,b+5,{align:"right"}),o.setFont(void 0,"bold"),o.setTextColor(...p),o.text("GRAND TOTAL:",140,b+12),o.text(`Rs. ${d.toFixed(2)}`,185,b+12,{align:"right"}),o.save(`${a.poNumber}.pdf`)};return e("div",{className:"p-3 bg-gray-50 min-h-screen",children:t("div",{className:"mx-auto bg-white rounded-xl shadow-lg border border-gray-200 p-8",children:[t("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 border-b pb-6 gap-4",children:[e("div",{children:e("h1",{className:"text-3xl font-extrabold text-gray-900 tracking-tight",children:"Purchase Order"})}),t("div",{className:"flex gap-3",children:[t("button",{onClick:x,className:"flex items-center gap-2 bg-emerald-600 text-white px-5 py-2.5 rounded-lg hover:bg-emerald-700 transition font-semibold shadow-md",children:[e(pe,{})," Excel"]}),t("button",{onClick:n,className:"flex items-center gap-2 bg-rose-600 text-white px-5 py-2.5 rounded-lg hover:bg-rose-700 transition font-semibold shadow-md",children:[e(me,{})," PDF"]})]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-10",children:[t("div",{className:"space-y-1",children:[e("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Vendor Name"}),e("input",{type:"text",className:"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none",placeholder:"Supplier name...",value:a.name,onChange:o=>c({...a,name:o.target.value})})]}),t("div",{className:"space-y-1",children:[e("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"PO Number"}),e("input",{type:"text",readOnly:!0,className:"w-full bg-gray-100 border border-gray-300 rounded-lg p-3 text-gray-600 font-mono",value:a.poNumber})]}),e("div",{className:"space-y-1",children:e(Me,{selectedDate:a.date,onDateChange:o=>c({...a,date:o})})})]}),e("div",{className:"overflow-visible mb-6",children:t("table",{className:"w-full border-collapse",children:[e("thead",{children:t("tr",{className:"bg-green-700 text-white",children:[e("th",{className:"p-4 text-left rounded-tl-lg font-semibold",children:"Product Description"}),e("th",{className:"p-4 text-center font-semibold w-28",children:"Qty"}),e("th",{className:"p-4 text-right font-semibold w-44",children:"Unit Price (â‚¹)"}),e("th",{className:"p-4 text-right font-semibold w-44",children:"Total (â‚¹)"}),e("th",{className:"p-4 text-center rounded-tr-lg w-16"})]})}),e("tbody",{className:"divide-y divide-gray-200",children:l.map(o=>t("tr",{className:"hover:bg-green-50/30 transition",children:[t("td",{className:"p-3 relative",children:[e("input",{autoComplete:"off",type:"text",className:"w-full p-2 border border-transparent focus:border-green-500 focus:bg-white rounded outline-none",placeholder:"Search items...",value:o.name,onChange:p=>h(o.id,"name",p.target.value)}),i.rowId===o.id&&i.results.length>0&&e("div",{className:"absolute z-50 left-2 right-2 mt-1 bg-white border border-gray-300 rounded-xl shadow-2xl max-h-56 overflow-y-auto ring-2 ring-green-500 ring-opacity-20",children:i.results.map(p=>t("div",{className:"p-3 hover:bg-green-600 hover:text-white cursor-pointer flex justify-between items-center transition",onClick:()=>f(o.id,p),children:[e("span",{className:"font-semibold",children:p.productName}),t("span",{className:"text-xs opacity-80 font-mono",children:["â‚¹",p.productPrice]})]},p.productid))})]}),e("td",{className:"p-3",children:e("input",{type:"number",className:"w-full p-2 text-center border border-gray-200 rounded",value:o.qty,onChange:p=>h(o.id,"qty",parseInt(p.target.value)||0)})}),e("td",{className:"p-3",children:e("input",{type:"number",className:"w-full p-2 text-right border border-gray-200 rounded font-mono",value:o.price,onChange:p=>h(o.id,"price",parseFloat(p.target.value)||0)})}),t("td",{className:"p-3 text-right font-bold text-gray-700 font-mono",children:["â‚¹",o.total.toLocaleString()]}),e("td",{className:"p-3 text-center",children:e("button",{onClick:()=>g(o.id),className:"text-gray-400 hover:text-red-600 transition p-2",children:e(ge,{})})})]},o.id))})]})}),t("button",{onClick:N,className:"flex items-center gap-2 text-green-700 font-bold hover:text-green-900 transition mb-12 group",children:[e("span",{className:"bg-green-100 p-1 rounded-full group-hover:bg-green-200",children:e(he,{size:12})})," Add New Product"]}),t("div",{className:"flex flex-col md:flex-row justify-between items-start gap-8 border-t pt-8",children:[t("div",{className:"w-full md:w-1/2",children:[e("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-2",children:"Terms & Conditions"}),e("textarea",{className:"w-full border border-gray-200 rounded-lg p-3 text-sm h-24 text-gray-600 focus:ring-2 focus:ring-green-500 outline-none",placeholder:"Enter notes or terms here..."})]}),t("div",{className:"w-full md:w-1/3 bg-green-50/50 p-6 rounded-xl border border-green-100 space-y-4",children:[t("div",{className:"flex justify-between text-gray-600",children:[e("span",{children:"Subtotal"}),t("span",{className:"font-mono",children:["â‚¹",m.toLocaleString()]})]}),t("div",{className:"flex justify-between text-gray-600",children:[e("span",{children:"GST (18%)"}),t("span",{className:"font-mono",children:["â‚¹",y.toLocaleString()]})]}),t("div",{className:"flex justify-between text-2xl font-black text-green-900 border-t border-green-200 pt-4",children:[e("span",{children:"Total"}),t("span",{children:["â‚¹",d.toLocaleString()]})]}),t("button",{className:"w-full bg-green-700 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-green-800 transition shadow-xl mt-4",children:[e(Ne,{})," Confirm & Submit"]})]})]})]})})}function Ye({product:a,onClose:c,onSave:l}){const[s,i]=E(0);if(we(()=>{a&&i(0)},[a]),!a)return null;const r=Math.max(0,a.stock+s);return t("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e("div",{className:"absolute inset-0 bg-black/40",onClick:c}),t("div",{className:"relative z-10 w-full max-w-md rounded-xl bg-white",children:[t("div",{className:"flex justify-between px-5 py-4",children:[t("h3",{className:"font-bold text-lg",children:["Adjust Stock â€“ ",a.productName]}),e("button",{onClick:c,children:e(W,{className:"h-5 w-5"})})]}),t("div",{className:"space-y-4 px-5 py-4",children:[t("div",{className:"bg-green-700 hover:bg-green-500 p-4 rounded-lg",children:[e("p",{className:"text-sm text-white",children:"Current Stock"}),t("p",{className:"text-2xl font-bold text-white",children:[a.stock," ",a.unit]})]}),t("div",{className:"flex items-center gap-2",children:[e("button",{className:"text-green-500 hover:text-black",onClick:()=>i(m=>m-1),children:e(Ce,{})}),e("input",{type:"number",value:s,onInput:m=>i(+m.target.value),className:"w-24 rounded-lg  text-center p-2 border border-gray-300 text-sm focus:border-green-500 focus:outline-none focus:ring-1 focus:ring-green-500"}),e("button",{className:"text-green-500 hover:text-black",onClick:()=>i(m=>m+1),children:e(De,{})})]}),t("p",{className:"text-sm",children:["New Stock: ",e("strong",{children:r})]})]}),t("div",{className:"flex justify-end gap-2 px-5 py-4",children:[e("button",{className:"bg-red-700 text-white hover:bg-red-500 px-4 py-2 rounded-md",onClick:c,children:"Cancel"}),t("button",{onClick:()=>l(a.productid,r),className:"flex items-center gap-2 bg-green-700 hover:bg-green-500 text-white px-4 py-2 rounded-md",children:[e(J,{className:"h-4 w-4"}),"Save"]})]})]})]})}function $e(){const[a,c]=E((G??[]).map(d=>({productid:Number(d?.productid??0),productCode:"PRD00"+String(d?.productid??""),productName:String(d?.productName??"Unknown Product"),stock:Number(d?.stock??0),unit:String(d?.unit??""),productPrice:Number(d?.productPrice??0),category:String(d?.category??""),description:String(d?.description??""),productImageUrl:String(d?.productImageUrl??"")}))),[l,s]=E(""),[i,r]=E(null),m=a.filter(d=>d.productName.toLowerCase().includes(l.toLowerCase())),y=(d,N)=>{let g="";c(h=>h.map(f=>f.productid===d?(g=f.productName,{...f,stock:N}):f)),g&&O(`${g} 
 stock updated successfully!`),r(null)};return t("div",{className:"w-full rounded-xl bg-white shadow-md border border-gray-100",children:[t("div",{className:"flex flex-col gap-4 p-5 md:flex-row md:items-center md:justify-between ",children:[e("h2",{className:"text-xl font-semibold text-gray-800",children:"Inventory Update"}),t("div",{className:"flex gap-2",children:[t("div",{className:"relative",children:[e(H,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"}),e("input",{className:"w-64 rounded-lg border border-gray-300 px-10 py-2 text-sm focus:border-green-500 focus:outline-none focus:ring-1 focus:ring-green-500",placeholder:"Search product...",onInput:d=>s(d.target.value)})]}),t("button",{className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:[e(Ie,{className:"h-4 w-4"}),"Download"]})]})]}),t("div",{className:"overflow-y-auto",style:{maxHeight:"67vh"},children:[t("table",{className:"w-full text-left rounded-xl text-sm table-auto",children:[e("thead",{className:"sticky top-0 bg-green-500 z-10 rounded-xl",children:t("tr",{className:"bg-green-700 text-white rounded-t-lg",children:[e("th",{className:"p-4 font-medium text-white",children:"Code"}),e("th",{className:"p-4 font-medium text-white",children:"Product"}),e("th",{className:"p-4 font-medium text-white",children:"Stock"}),e("th",{className:"p-4 font-medium text-white",children:"Price"}),e("th",{className:"p-4 font-medium text-white",children:"Action"})]})}),e("tbody",{children:m.map((d,N)=>t("tr",{className:"last:border-none hover:bg-green-100",children:[e("td",{className:"p-4 text-gray-700",children:d.productCode}),e("td",{className:"p-4",children:t("div",{className:"flex items-center gap-3",children:[e("img",{src:d.productImageUrl,alt:d.productName,className:"h-9 w-9 rounded-full object-cover border"}),e("span",{className:"font-medium text-gray-800",children:d.productName})]})}),e("td",{className:"p-4",children:t("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${d.stock>20?"bg-green-100 text-green-700":d.stock>5?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[d.stock," ",d.unit]})}),e("td",{className:"p-4 text-gray-700",children:d.productPrice}),e("td",{className:"p-4",children:e("button",{className:"rounded-md p-2 text-green-600 hover:bg-green-500/100 hover:text-white",title:"Update Stock",onClick:()=>r(d),children:e(Q,{className:"h-4 w-4"})})})]},d.productId+"-"+N))})]}),e(Ye,{product:i,onClose:()=>r(null),onSave:y})]})]})}function qe({isOpen:a,onClose:c,onSave:l,item:s}){const[i,r]=v({productCode:"",productName:"",category:"",unit:"",productPrice:"",stock:"",description:"",productImage:null}),[m,y]=v({}),[d,N]=v(null);Y(()=>{s?(r({productCode:s.productCode||"",productName:s.productName||"",category:s.category||"",unit:s.unit||"",productPrice:s.productPrice||"",stock:s.stock||"",description:s.description||"",productImage:null}),N(s.productImageUrl||null)):(r({productCode:"",productName:"",category:"",unit:"",productPrice:"",description:"",productImage:null}),N(null))},[s]);const g=x=>{const{name:n,value:o}=x.target;r(p=>({...p,[n]:o}))},h=x=>{const n=x.target.files[0];n&&(r(o=>({...o,productImage:n})),N(URL.createObjectURL(n)))},f=x=>{x.preventDefault();const n={};i.productCode||(n.productCode="Required"),i.productName||(n.productName="Required"),i.category||(n.category="Required"),i.unit||(n.unit="Required"),i.productPrice||(n.productPrice="Required"),y(n),!Object.keys(n).length&&(l({...i,id:s?.productid}),c())};return a?t("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[e("div",{className:"absolute inset-0 bg-black/50",onClick:c}),t("div",{className:"relative z-10 w-full max-w-2xl rounded-xl bg-white shadow-2xl flex flex-col max-h-[90vh]",children:[t("div",{className:"sticky top-0 flex items-center justify-between px-6 py-4 bg-green-700 text-white rounded-t-xl",children:[e("h2",{id:"modal-title",className:"text-lg font-semibold",children:s?"Update Item":"Add New Item"}),e("button",{onClick:c,"aria-label":"Close modal",className:"hover:text-green-200",children:e(W,{className:"h-5 w-5"})})]}),e("div",{className:"px-6 py-5 overflow-y-auto",children:t("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[[["productCode","Product Code"],["productName","Product Name"],["category","Category"],["unit","Unit"]].map(([x,n])=>t("div",{className:"flex flex-col gap-1",children:[e("label",{htmlFor:x,className:"text-sm font-medium",children:n}),e("input",{id:x,name:x,value:i[x],onChange:g,className:"input"}),m[x]&&e("span",{className:"text-xs text-red-600",children:m[x]})]},x)),t("div",{className:"flex flex-col gap-1",children:[e("label",{className:"text-sm font-medium",children:"Price (â‚¹)"}),e("input",{type:"number",name:"productPrice",value:i.productPrice,onChange:g,className:"input"}),m.productPrice&&e("span",{className:"text-xs text-red-600",children:m.productPrice})]}),t("div",{className:"md:col-span-2 flex flex-col gap-1",children:[e("label",{className:"text-sm font-medium",children:"Description"}),e("textarea",{name:"description",value:i.description,onChange:g,className:"input min-h-[90px]"})]}),t("div",{className:"md:col-span-2 flex flex-col gap-3",children:[e("label",{className:"text-sm font-medium",children:"Product Image"}),e("input",{type:"file",accept:"image/*",onChange:h}),d&&e("img",{src:d,alt:"Product preview",className:"h-32 w-32 rounded-lg object-cover border"})]})]})}),t("div",{className:"sticky bottom-0 flex justify-end gap-3 px-6 py-4 border-t bg-white rounded-b-xl",children:[e("button",{onClick:c,className:"px-4 py-2 clear-button",children:"Cancel"}),t("button",{onClick:f,className:"flex items-center gap-2 primary-button px-4 py-2",children:[e(J,{className:"h-4 w-4"}),s?"Update":"Save"]})]})]})]}):null}function _e(){const[a,c]=v([]);Y(()=>{const n=(G??[]).map(o=>({productid:Number(o?.productid??0),productCode:"PRD00"+String(o?.productid??""),productName:o?.productName??"Unknown Product",stock:Number(o?.stock??0),unit:o?.unit??"",productPrice:Number(o?.productPrice??0),category:o?.category??"",description:o?.description??"",productImageUrl:o?.productImageUrl??""}));c(n)},[]);const[l,s]=M.useState(""),i=a.filter(n=>n.productName.toLowerCase().includes(l.toLowerCase())),[r,m]=M.useState(!1),[y,d]=M.useState(null),N=()=>{d(null),m(!0)},g=n=>{d(n),m(!0)},h=()=>{m(!1)},f=n=>{c(o=>[...o,n]),h()},x=n=>{const o=Number(n);return Number.isFinite(o)?o.toFixed(2):"0.00"};return t("div",{className:"w-full rounded-xl bg-white shadow-md border border-gray-100",children:[t("div",{className:"flex flex-col gap-4 p-5 md:flex-row md:items-center md:justify-between ",children:[e("h2",{className:"text-xl font-semibold text-gray-800",children:"Item List"}),t("div",{className:"flex gap-2",children:[t("div",{className:"relative",children:[e(H,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"}),e("input",{className:"w-64 rounded-lg border border-gray-300 px-10 py-2 text-sm focus:border-green-500 focus:outline-none focus:ring-1 focus:ring-green-500",placeholder:"Search product...",onInput:n=>s(n.target.value)})]}),t("button",{className:"flex items-center gap-1 px-2 py-2 primary-button",onClick:()=>N(),children:[e(Pe,{className:"h-5 w-5"}),e("span",{children:"Add  Item"})]})]})]}),e("div",{className:"overflow-y-auto",style:{maxHeight:"67vh"},children:t("table",{className:"w-full text-left rounded-xl text-sm table-auto",children:[e("thead",{className:"sticky top-0 bg-green-700 z-10 rounded text-white",children:t("tr",{children:[e("th",{className:"px-4 py-3",children:"Item Code"}),e("th",{className:"px-4 py-3",children:"Item Name"}),e("th",{className:"px-4 py-3",children:"Category"}),e("th",{className:"px-4 py-3",children:"Unit"}),e("th",{className:"px-4 py-3",children:"Price (â‚¹)"}),e("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e("tbody",{children:i.map((n,o)=>t("tr",{className:"last:border-none hover:bg-green-100",children:[e("td",{className:"px-4 py-3 text-gray-700",children:n.productCode}),e("td",{className:"px-4 py-3 font-medium text-gray-800",children:n.productName}),e("td",{className:"px-4 py-3 text-gray-700",children:n.category}),e("td",{className:"px-4 py-3 text-gray-700",children:n.unit}),e("td",{className:"px-4 py-3 text-gray-700",children:x(n.productPrice)}),e("td",{className:"px-4 py-3",children:t("div",{className:"flex justify-end gap-2",children:[t("div",{className:"relative group",children:[e("button",{id:`edit-btn-${n.productId_index}`,onClick:()=>g(n),className:"inline-flex items-center justify-center rounded-md p-2 secondary-button","aria-label":"Edit item",children:e(Q,{className:"h-4 w-4 text-white"})}),e(_,{anchorId:`edit-btn-${n.productId_index}`,content:"Edit",place:"top"})]}),t("div",{className:"relative group",children:[e("button",{id:`delete-btn-${n.productId_index}`,onClick:()=>handleDeleteClick(n),className:"inline-flex items-center justify-center clear-button p-2","aria-label":"Delete item",children:e(Se,{className:"h-4 w-4 text-white"})}),e(_,{anchorId:`delete-btn-${n.productId_index}`,content:"Delete",place:"top"})]})]})})]},n.productId+"-"+o))})]})}),e(qe,{isOpen:r,onClose:h,onSave:f,item:y})]})}function ze(){return t(ye,{children:[e(le,{children:t(F,{path:"/",element:e(Oe,{}),children:[e(F,{index:!0,element:e(Re,{})}),e(F,{path:"sales/pos",element:e(Ge,{})}),e(F,{path:"master/itemMaster",element:e(_e,{})}),e(F,{path:"sales/order",element:e("div",{children:"Sales Order"})}),e(F,{path:"sales/invoice",element:e("div",{children:"Sales Invoice"})}),e(F,{path:"purchase/order",element:e(je,{})}),e(F,{path:"inventory/update",element:e($e,{})})]})}),e(ve,{})]})}function lt(a){return{html:re(e(oe,{location:a,children:e(ze,{})}))}}export{lt as render};
